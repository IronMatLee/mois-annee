<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Les 12 Mois de Baptiste</title>

    <!-- PWA Setup -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="theme-color" content="#4a90e2" />

    <!-- Libs -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&family=Fredoka:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
      :root {
        --winter-bg: #e3f2fd;
        --winter-color: #1565c0;
        --spring-bg: #e8f5e9;
        --spring-color: #2e7d32;
        --summer-bg: #fff3e0;
        --summer-color: #ef6c00;
        --autumn-bg: #fbe9e7;
        --autumn-color: #d84315;
        --neutral: #f0f2f5;
        --text: #2c3e50;
      }

      body {
        font-family: "Fredoka", sans-serif;
        background-color: var(--neutral);
        margin: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        user-select: none;
        -webkit-tap-highlight-color: transparent; /* Supprime le flash bleu au clic sur Android */
      }

      /* --- Header --- */
      header {
        background: white;
        padding: 10px 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 10;
        flex-shrink: 0; /* EmpÃªche le header de s'Ã©craser */
      }

      h1 {
        font-family: "Caveat", cursive;
        margin: 0;
        font-size: 1.8rem;
        color: var(--text);
      }

      .score-box {
        background: #ffecb3;
        padding: 5px 15px;
        border-radius: 20px;
        font-weight: bold;
        color: #d35400;
        font-size: 1.2rem;
      }

      /* --- Menu --- */
      #menu-screen {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 15px;
        overflow-y: auto;
        padding: 20px;
      }

      .menu-btn {
        background: white;
        border: none;
        padding: 15px 20px;
        width: 90%;
        max-width: 400px;
        border-radius: 20px;
        font-size: 1.3rem;
        font-family: "Fredoka", sans-serif;
        color: var(--text);
        box-shadow: 0 4px 0 #bdc3c7;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 15px;
        transition: transform 0.1s;
      }

      .menu-btn:active {
        transform: translateY(4px);
        box-shadow: none;
      }
      .menu-btn i {
        font-size: 1.8rem;
        width: 40px;
        text-align: center;
      }

      .btn-learn {
        color: #27ae60;
        border-left: 8px solid #27ae60;
      }
      .btn-order {
        color: #3498db;
        border-left: 8px solid #3498db;
      }
      .btn-color {
        color: #e67e22;
        border-left: 8px solid #e67e22;
      }
      .btn-write {
        color: #9b59b6;
        border-left: 8px solid #9b59b6;
      }

      /* --- Zone de Jeu --- */
      #game-area {
        flex: 1;
        display: none;
        flex-direction: column;
        align-items: center;
        overflow: hidden; /* Important pour le scroll interne */
      }

      .instruction-bar {
        width: 100%;
        background: #fff;
        padding: 10px;
        text-align: center;
        font-size: 1.1rem;
        color: #555;
        border-bottom: 1px solid #eee;
        flex-shrink: 0;
      }

      .scroll-container {
        flex: 1;
        width: 100%;
        overflow-y: auto;
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        justify-content: center;
      }

      .months-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        width: 100%;
        max-width: 800px;
        /* Padding bottom pour Ã©viter que les outils cachent le bas */
        padding-bottom: 100px;
        align-content: start;
      }

      .month-card {
        background: white;
        border-radius: 15px;
        padding: 10px;
        min-height: 110px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.08);
        cursor: pointer;
        border: 3px solid transparent;
        position: relative;
        touch-action: manipulation; /* AmÃ©liore la rÃ©activitÃ© tactile */
      }

      .month-card i,
      .month-card span.emoji {
        font-size: 2.2rem;
        margin-bottom: 8px;
        color: inherit; /* Prend la couleur du parent */
      }

      .month-name {
        font-size: 1.1rem;
        font-weight: bold;
        text-transform: capitalize;
        pointer-events: none; /* EmpÃªche de sÃ©lectionner le texte */
      }

      /* --- Styles SpÃ©cifiques Drag & Drop (Jeu Ordre) --- */

      /* La carte qu'on tient (Feedback visuel immÃ©diat) */
      .sortable-chosen {
        border: 3px solid #3498db !important;
        transform: scale(1.05);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2) !important;
        background: #e1f5fe !important;
        z-index: 100;
      }

      /* La carte fantÃ´me (l'endroit oÃ¹ elle va atterrir) */
      .sortable-ghost {
        opacity: 0.4;
        background: #ecf0f1 !important;
        border: 2px dashed #bdc3c7 !important;
      }

      /* --- Styles SpÃ©cifiques Jeu Couleurs --- */
      /* Ces classes forcent l'affichage complet (fond + bordure + texte) */
      .style-winter {
        background-color: var(--winter-bg) !important;
        color: var(--winter-color) !important;
        border-color: var(--winter-color) !important;
      }
      .style-spring {
        background-color: var(--spring-bg) !important;
        color: var(--spring-color) !important;
        border-color: var(--spring-color) !important;
      }
      .style-summer {
        background-color: var(--summer-bg) !important;
        color: var(--summer-color) !important;
        border-color: var(--summer-color) !important;
      }
      .style-autumn {
        background-color: var(--autumn-bg) !important;
        color: var(--autumn-color) !important;
        border-color: var(--autumn-color) !important;
      }

      /* Mode "Ã  colorier" (blanc avec pointillÃ©s) */
      .color-mode-neutral {
        background: white;
        border: 3px dashed #ccc;
        color: #ccc;
      }

      /* --- Styles Mode Apprendre --- */
      .learn-mode-card {
        transition: transform 0.2s;
      }
      .learn-mode-card:active {
        transform: scale(0.95);
      }
      .audio-hint {
        position: absolute;
        top: 5px;
        right: 5px;
        font-size: 0.8rem;
        opacity: 0.5;
      }

      /* --- Styles Jeu Ã‰criture --- */
      .input-month {
        width: 90%;
        padding: 5px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-family: "Fredoka", sans-serif;
        font-size: 1rem;
        text-align: center;
      }

      /* --- Footer Tools --- */
      .tools-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: white;
        padding: 10px 15px;
        display: flex;
        justify-content: center;
        gap: 10px;
        box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.05);
        z-index: 100;
        box-sizing: border-box;
      }

      .tool-btn {
        flex: 1; /* Boutons Ã©lastiques */
        max-width: 120px;
        padding: 12px 0;
        border-radius: 12px;
        border: none;
        font-weight: bold;
        font-family: "Fredoka", sans-serif;
        font-size: 1rem;
        cursor: pointer;
        opacity: 0.6;
        transition: all 0.2s;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        line-height: 1.1;
      }

      .tool-btn span {
        font-size: 0.8rem;
        margin-top: 4px;
      }

      .tool-btn.active {
        opacity: 1;
        transform: translateY(-5px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        border: 2px solid currentColor;
      }

      .btn-validate {
        background: #27ae60 !important;
        color: white !important;
        opacity: 1;
        box-shadow: 0 4px 0 #219150;
      }
      .btn-validate:active {
        transform: translateY(4px);
        box-shadow: none;
      }

      .btn-back {
        background: #95a5a6;
        color: white;
        flex: 0 0 60px; /* Taille fixe pour retour */
      }

      /* Feedback Ã©tats */
      .wrong {
        animation: shake 0.4s;
        border-color: #e74c3c !important;
      }
      .correct {
        border-color: #2ecc71 !important;
        transform: scale(1.05);
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }

      @media (max-width: 600px) {
        .months-grid {
          grid-template-columns: repeat(2, 1fr);
        }
        h1 {
          font-size: 1.5rem;
        }
        .tool-btn {
          font-size: 0.9rem;
          padding: 8px 0;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="score-box" id="score-display">ðŸŒŸ 0</div>
      <h1>Jeu de Baptiste</h1>
    </header>

    <!-- Menu Principal -->
    <div id="menu-screen">
      <button class="menu-btn btn-learn" onclick="startGame('learn')">
        <i class="fa-solid fa-graduation-cap"></i>
        Apprendre les mois
      </button>
      <button class="menu-btn btn-order" onclick="startGame('order')">
        <i class="fa-solid fa-arrow-down-1-9"></i>
        Remettre dans l'ordre
      </button>
      <button class="menu-btn btn-color" onclick="startGame('color')">
        <i class="fa-solid fa-palette"></i>
        Couleurs des saisons
      </button>
      <button class="menu-btn btn-write" onclick="startGame('write')">
        <i class="fa-solid fa-keyboard"></i>
        Mois manquants
      </button>
    </div>

    <!-- Zone de Jeu -->
    <div id="game-area">
      <div class="instruction-bar" id="instruction-text">Consigne...</div>
      <div class="scroll-container">
        <div class="months-grid" id="grid"></div>
      </div>
    </div>

    <!-- Barre d'outils -->
    <div class="tools-bar" id="tools-bar" style="display: none"></div>

    <script>
      // --- Configuration ---
      const monthsData = [
        {
          id: 1,
          name: "Janvier",
          season: "winter",
          icon: "fa-regular fa-snowflake",
          emoji: "",
        },
        {
          id: 2,
          name: "FÃ©vrier",
          season: "winter",
          icon: "fa-solid fa-person-skiing",
          emoji: "",
        },
        {
          id: 3,
          name: "Mars",
          season: "spring",
          icon: "fa-solid fa-seedling",
          emoji: "",
        },
        {
          id: 4,
          name: "Avril",
          season: "spring",
          icon: "fa-solid fa-egg",
          emoji: "",
        },
        {
          id: 5,
          name: "Mai",
          season: "spring",
          icon: "fa-solid fa-archway",
          emoji: "",
        },
        {
          id: 6,
          name: "Juin",
          season: "summer",
          icon: "fa-solid fa-sun",
          emoji: "",
        },
        {
          id: 7,
          name: "Juillet",
          season: "summer",
          icon: "fa-solid fa-umbrella-beach",
          emoji: "",
        },
        {
          id: 8,
          name: "AoÃ»t",
          season: "summer",
          icon: "fa-solid fa-ice-cream",
          emoji: "",
        },
        {
          id: 9,
          name: "Septembre",
          season: "autumn",
          icon: "fa-solid fa-school",
          emoji: "",
        },
        { id: 10, name: "Octobre", season: "autumn", icon: "", emoji: "ðŸŽƒ" },
        {
          id: 11,
          name: "Novembre",
          season: "autumn",
          icon: "fa-solid fa-wind",
          emoji: "",
        },
        {
          id: 12,
          name: "DÃ©cembre",
          season: "winter",
          icon: "fa-solid fa-sleigh",
          emoji: "",
        },
      ];

      const seasons = {
        winter: { name: "Hiver", color: "#1565c0", bg: "#e3f2fd" },
        spring: { name: "Printemps", color: "#2e7d32", bg: "#e8f5e9" },
        summer: { name: "Ã‰tÃ©", color: "#ef6c00", bg: "#fff3e0" },
        autumn: { name: "Automne", color: "#d84315", bg: "#fbe9e7" },
      };

      let currentMode = "";
      let selectedColorTool = null;
      let score = 0;
      let sortableInstance = null;

      // --- Moteur Vocal ---
      function speak(text) {
        if ("speechSynthesis" in window) {
          // Annuler la lecture en cours s'il y en a une
          window.speechSynthesis.cancel();
          const utterance = new SpeechSynthesisUtterance(text);
          utterance.lang = "fr-FR";
          utterance.rate = 0.9; // Un peu plus lent pour bien comprendre
          utterance.pitch = 1.1; // Un peu plus aigu pour Ãªtre joyeux
          window.speechSynthesis.speak(utterance);
        }
      }

      // --- Navigation ---
      function startGame(mode) {
        currentMode = mode;
        document.getElementById("menu-screen").style.display = "none";
        document.getElementById("game-area").style.display = "flex";
        document.getElementById("tools-bar").style.display = "flex";

        const grid = document.getElementById("grid");
        grid.innerHTML = "";
        if (sortableInstance) {
          sortableInstance.destroy();
          sortableInstance = null;
        }

        if (mode === "learn") setupLearnMode();
        if (mode === "order") setupOrderGame();
        if (mode === "color") setupColorGame();
        if (mode === "write") setupWriteGame();
      }

      function returnToMenu() {
        document.getElementById("menu-screen").style.display = "flex";
        document.getElementById("game-area").style.display = "none";
        document.getElementById("tools-bar").style.display = "none";
        window.speechSynthesis.cancel();
      }

      // --- GÃ©nÃ©rateur de Cartes ---
      function createCard(month) {
        const div = document.createElement("div");
        div.className = "month-card";
        div.setAttribute("data-id", month.id);
        div.setAttribute("data-season", month.season);

        const iconHtml = month.emoji
          ? `<span class="emoji">${month.emoji}</span>`
          : `<i class="${month.icon}"></i>`;

        div.innerHTML = `${iconHtml}<div class="month-name">${month.name}</div>`;
        return div;
      }

      // --- MODE 0 : Apprendre ---
      function setupLearnMode() {
        document.getElementById("instruction-text").textContent =
          "Touche une carte pour Ã©couter le mois.";
        const grid = document.getElementById("grid");
        const toolsBar = document.getElementById("tools-bar");

        // Affichage simple dans l'ordre avec bonnes couleurs
        monthsData.forEach((m) => {
          const card = createCard(m);
          // Application directe du style correct
          card.classList.add(`style-${m.season}`, "learn-mode-card");

          // Petit icone son
          const soundIcon = document.createElement("i");
          soundIcon.className = "fa-solid fa-volume-high audio-hint";
          card.appendChild(soundIcon);

          card.onclick = () => {
            // Animation click
            card.style.transform = "scale(0.95)";
            setTimeout(() => (card.style.transform = "scale(1)"), 150);
            // Audio
            speak(m.name);
          };
          grid.appendChild(card);
        });

        toolsBar.innerHTML = `<button class="tool-btn btn-back" onclick="returnToMenu()"><i class="fa-solid fa-arrow-left"></i> Menu</button>`;
      }

      // --- JEU 1 : Ordre ---
      function setupOrderGame() {
        document.getElementById("instruction-text").textContent =
          "Glisse les Ã©tiquettes pour les mettre dans l'ordre !";
        const grid = document.getElementById("grid");

        // MÃ©lange
        let shuffled = [...monthsData].sort(() => Math.random() - 0.5);

        shuffled.forEach((m) => {
          const card = createCard(m);
          card.style.cursor = "grab";
          // Couleur neutre au dÃ©part pour ne pas donner d'indice de saison (optionnel, ici on met neutre)
          card.style.background = "white";
          card.style.color = "#555";
          grid.appendChild(card);
        });

        // Config Drag & Drop AmÃ©liorÃ©e
        sortableInstance = new Sortable(grid, {
          animation: 250, // Animation fluide
          delay: 100, // Petit dÃ©lai pour Ã©viter le drag accidentel sur touch
          delayOnTouchOnly: true,
          chosenClass: "sortable-chosen", // Classe quand on tient l'item
          ghostClass: "sortable-ghost", // Classe de l'emplacement vide
          forceFallback: false, // Utiliser le DnD natif HTML5 (souvent plus fluide sur Chrome Android rÃ©cent)
          onStart: function (evt) {
            // Petit retour haptique si supportÃ© (vibration)
            if (navigator.vibrate) navigator.vibrate(20);
          },
        });

        setupValidationButton(validateOrder);
      }

      function validateOrder() {
        const cards = document.querySelectorAll(".month-card");
        let errors = 0;

        cards.forEach((card, index) => {
          const id = parseInt(card.getAttribute("data-id"));
          if (id === index + 1) {
            card.classList.add("correct");
            // RÃ©vÃ©ler la vraie couleur quand c'est bon pour faire joli
            const season = card.getAttribute("data-season");
            card.classList.add(`style-${season}`);
          } else {
            card.classList.add("wrong");
            setTimeout(() => card.classList.remove("wrong"), 500);
            errors++;
          }
        });

        if (errors === 0) handleWin();
      }

      // --- JEU 2 : Couleurs ---
      function setupColorGame() {
        document.getElementById("instruction-text").textContent =
          "Choisis une saison en bas, puis colorie les mois.";
        const grid = document.getElementById("grid");

        monthsData.forEach((m) => {
          const card = createCard(m);
          card.classList.add("color-mode-neutral"); // Blanc + pointillÃ©s
          card.onclick = () => applyColor(card);
          grid.appendChild(card);
        });

        // Palette
        const toolsBar = document.getElementById("tools-bar");
        toolsBar.innerHTML = `<button class="tool-btn btn-back" onclick="returnToMenu()"><i class="fa-solid fa-arrow-left"></i></button>`;

        Object.keys(seasons).forEach((key) => {
          const s = seasons[key];
          const btn = document.createElement("button");
          btn.className = "tool-btn";
          btn.style.backgroundColor = s.bg;
          btn.style.color = s.color;
          btn.innerHTML = `<i class="fa-solid fa-brush"></i><span>${s.name}</span>`;
          btn.onclick = () => selectColorTool(key, btn);
          toolsBar.appendChild(btn);
        });

        const validateBtn = document.createElement("button");
        validateBtn.className = "tool-btn btn-validate";
        validateBtn.innerHTML =
          '<i class="fa-solid fa-check"></i><span>OK</span>';
        validateBtn.onclick = validateColor;
        toolsBar.appendChild(validateBtn);

        // Select premier outil
        selectColorTool("winter", toolsBar.children[1]);
      }

      function selectColorTool(seasonKey, btnElement) {
        selectedColorTool = seasonKey;
        document
          .querySelectorAll(".tool-btn")
          .forEach((b) => b.classList.remove("active"));
        btnElement.classList.add("active");
      }

      function applyColor(card) {
        if (!selectedColorTool) return;

        // 1. Enlever style neutre
        card.classList.remove("color-mode-neutral");

        // 2. Enlever toutes les anciennes classes de style
        card.classList.remove(
          "style-winter",
          "style-spring",
          "style-summer",
          "style-autumn"
        );

        // 3. Ajouter la nouvelle classe (Force Background, Border, Text)
        card.classList.add(`style-${selectedColorTool}`);

        // 4. Stocker le choix
        card.setAttribute("data-user-choice", selectedColorTool);

        // Audio feedback lÃ©ger (nom de la saison)
        // speak(seasons[selectedColorTool].name); // Optionnel, peut Ãªtre saoulant
      }

      function validateColor() {
        const cards = document.querySelectorAll(".month-card");
        let errors = 0;
        cards.forEach((card) => {
          const correct = card.getAttribute("data-season");
          const userChoice = card.getAttribute("data-user-choice");
          if (correct === userChoice) {
            card.classList.add("correct");
          } else {
            card.classList.add("wrong");
            setTimeout(() => card.classList.remove("wrong"), 500);
            errors++;
          }
        });
        if (errors === 0) handleWin();
      }

      // --- JEU 3 : Ã‰criture ---
      function setupWriteGame() {
        document.getElementById("instruction-text").textContent =
          "Ã‰cris le nom des mois disparus.";
        const grid = document.getElementById("grid");
        const toolsBar = document.getElementById("tools-bar");

        // Cacher 3 Ã  4 mois
        const hiddenIndices = [];
        while (hiddenIndices.length < 4) {
          let r = Math.floor(Math.random() * 12);
          if (!hiddenIndices.includes(r)) hiddenIndices.push(r);
        }

        monthsData.forEach((m, index) => {
          const card = createCard(m);
          // On affiche la couleur pour aider, sinon c'est trop dur
          card.classList.add(`style-${m.season}`);

          if (hiddenIndices.includes(index)) {
            card.querySelector(".month-name").style.display = "none";
            const input = document.createElement("input");
            input.type = "text";
            input.className = "input-month";
            input.placeholder = "?";
            input.autocomplete = "off";
            card.appendChild(input);
          }
          grid.appendChild(card);
        });

        setupValidationButton(validateWrite);
      }

      function validateWrite() {
        const cards = document.querySelectorAll(".month-card");
        let errors = 0;
        cards.forEach((card, index) => {
          const input = card.querySelector("input");
          if (input && input.style.display !== "none") {
            const correct = monthsData[index].name.toLowerCase();
            const val = input.value.trim().toLowerCase();
            if (val === correct) {
              card.classList.add("correct");
              card.querySelector(".month-name").style.display = "block";
              input.style.display = "none";
            } else {
              card.classList.add("wrong");
              setTimeout(() => card.classList.remove("wrong"), 500);
              errors++;
            }
          }
        });
        if (errors === 0) handleWin();
      }

      // --- Helpers ---
      function setupValidationButton(fn) {
        const toolsBar = document.getElementById("tools-bar");
        toolsBar.innerHTML = `
                <button class="tool-btn btn-back" onclick="returnToMenu()"><i class="fa-solid fa-arrow-left"></i></button>
                <button class="tool-btn btn-validate" onclick="applyValidation()">VÃ‰RIFIER</button>
            `;
        window.applyValidation = fn;
      }

      function handleWin() {
        score += 10;
        document.getElementById("score-display").textContent = `ðŸŒŸ ${score}`;
        document.getElementById("instruction-text").textContent =
          "BRAVO BAPTISTE ! ðŸŽ‰";
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        speak("Bravo Baptiste, c'est gagnÃ© !");
      }
    </script>
  </body>
</html>
